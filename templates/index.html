<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="/static/plugins/bootstrap/css/bootstrap.css"/>
    <link rel="stylesheet" href="/static/plugins/font-awesome/css/font-awesome.css"/>
    <link rel="stylesheet" href="/static/css/edmure.css"/>
    <link rel="stylesheet" href="/static/css/commons.css"/>
    <link rel="stylesheet" href="/static/css/row-avatar.css"/>

    <script type="text/javascript" src="/static/js/jquery-1.12.4.js"></script>
    <script type="text/javascript" src="/static/plugins/bootstrap/js/bootstrap.js"></script>
</head>
<body>
{% include 'include/header.html' %}
<div class="container">
    <div class="col-md-8">
        <div class="article-list">
            {% for row in article_list %}
                <div class="article-item clearfix">
                    <h3><a href="/{{ row.blog.site }}/{{ row.articledetail.article.nid }}.html">{{ row.title }}</a></h3>
                    <div class="clearfix">
                        <a class="active left" href="#" style="height: 80px;width: 80px">
                            {% if row.article_img != None %}
                                <img style="height: 80px;width: 80px"
                                     src="/{{ row.article_img }}">
                            {% endif %}
                        </a>
                        {{ row.summary }}
                    </div>
                    <div class="footers">
                        <a href="#" class="recommend" user_id="{{ request.session.user_info.nid }}">
                            <i class="fa fa-user-o" aria-hidden="true"></i>
                            <span>{{ row.blog.user.nickname }}</span>
                        </a>
                        <span>发布时间:{{ row.creat_time }}</span>
                        <a href="/{{ row.blog.site }}/{{ row.articledetail.article.nid }}.html" class="ele">
                            <i class="fa fa-commenting-o" aria-hidden="true"></i>
                            <span>{{ row.comment_count }}</span>
                            <a class="up" id='give_up' up_or_down="1" article_id="{{ row.nid }}">
                                <i class="fa fa-thumbs-o-up" aria-hidden="true"></i>
                                <span id="up_count{{ row.nid }}">{{ row.up_count }}</span>
                            </a>
                            <a class="down" id='give_up' up_or_down="0" article_id="{{ row.nid }}">
                                <i class="fa fa-thumbs-o-down" aria-hidden="true"></i>
                                <span id="down_count{{ row.nid }}">{{ row.down_count }}</span>
                            </a>
                        </a>
                        <span>阅读({{ row.read_count }})</span>
                        <span class="tips" id="give_up_resule{{ row.nid }}"></span>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="clearfix">
            <ul class="pagination">
                {{ page_str }}
            </ul>
        </div>

    </div>
</div>
{% block js %}
    <script src="/static/js/jquery-1.12.4.js"></script>
    <script>
        $('div #give_up').click(function () {
            var article_id = $(this).attr('article_id');
            var user_id = $('.recommend').attr('user_id');
            if (user_id == '') {
                alert('请先登录')
            } else {
                var up_or_down = $(this).attr('up_or_down');
                $.ajax({
                    url: 'article_up_or_down/',
                    type: "POST",
                    async: false,
                    data: {
                        'article_id': article_id,
                        'user_id': user_id,
                        'up_or_down': up_or_down,
                    },
                    dataType: 'JSON',
                    success: function (arg) {
                        if (arg.status === 1) {
                            {#点赞成功#}
                            $('#up_count' + article_id).html(arg.count_num);
                            {#$('#give_up_resule' + article_id).html(arg.message).show(300).delay(1000).hide(300);#}
                            $('#give_up_resule' + article_id).html(arg.message).addClass('alert-success').fadeIn().delay(1500).fadeOut()
                        } else if (arg.status === 2) {
                            {#踩赞成功#}
                            $('#down_count' + article_id).html(arg.count_num);
                            $('#give_up_resule' + article_id).html(arg.message).addClass('alert-success').fadeIn().delay(1500).fadeOut()
                        } else if (arg.status === 3) {
                            {#取消点赞#}
                            $('#up_count' + article_id).html(arg.count_num);
                            $('#give_up_resule' + article_id).html(arg.message).addClass('alert-info').fadeIn().delay(1500).fadeOut()
                        } else if (arg.status === 4) {
                            {#已踩赞，请勿点赞#}
                            $('#give_up_resule' + article_id).html(arg.message).addClass('alert-warning').fadeIn().delay(1500).fadeOut()
                        } else if (arg.status === 5) {
                            {#取消踩暂#}
                            $('#down_count' + article_id).html(arg.count_num);
                            $('#give_up_resule' + article_id).html(arg.message).addClass('alert-info').fadeIn().delay(1500).fadeOut()
                        } else if (arg.status === 6) {
                            {#已点赞，请勿踩赞#}
                            $('#give_up_resule' + article_id).html(arg.message).addClass('alert-warning').fadeIn().delay(1500).fadeOut()
                        }
                    }
                })
            }
        });
    </script>
{% endblock %}
</body>
</html>